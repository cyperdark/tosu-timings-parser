<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tosu timings graphs</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap');

        .block {
            font-family: 'Montserrat', sans-serif;
            text-align: center;
            margin-bottom: 3em;
            margin-top: 6em;
        }

        #selectro {
            margin: 0 auto;
            padding: 0.6em 1.7em;
            font-size: 30px;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            display: block;
        }
    </style>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
        let selected = '';
        let chart = '';
        let stats = [];

        const colors = [
            '#FF004F',
            '#FF7F50',
            '#954535',
            '#FCF75E',
            '#90EE90',
            '#00CCCC',
            '#0070FF',
            '#8F00FF',
            '#E52B50',
            '#FFFAFA',
            '#C0C0C0',
            '#242124',
        ]

        const graph_options = {
            chart: {
                width: window.innerWidth - 100, height: 400, type: 'area',
                animations: {
                    enabled: false,
                    easing: 'easeinout',
                    speed: 800,
                    animateGradually: {
                        enabled: true,
                        delay: 150
                    },
                    dynamicAnimation: {
                        enabled: true,
                        speed: 350
                    }
                }
            },
            colors,
            dataLabels: { enabled: false },
            stroke: { curve: 'smooth' },
            tooltip: {
                x: {
                    formatter: function (value) {
                        return new Date(value)
                            .toISOString()
                            .split('T')[1]
                            .replace('Z', '')
                    }
                },
            },
            series: [],
            xaxis: {
                type: "numeric",
                categories: [],
                labels: {
                    formatter: function (value, timestamp) {
                        return new Date(value).toISOString() // The formatter function overrides format property
                    }
                }
            },
        }


        const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));
        async function main(params) {
            const request = await fetch('/rust.json');
            const text = await request.text();


            stats = JSON.parse(text);
            buildUI();
            buildGraph();
        };


        function buildUI() {
            const select = document.createElement("select");
            select.id = "selectro";


            const options = Object.keys(stats);
            options.forEach((optionText) => {
                const option = document.createElement("option");
                option.text = optionText;
                select.add(option);
            });


            select.addEventListener("change", () => {
                selected = select.value;
                buildGraph();
            });


            const div = document.createElement('div');
            div.classList.add('block');
            div.innerHTML = `<div id="graph"></div>`;


            document.body.appendChild(select);
            document.body.append(div);


            chart = new ApexCharts(document.querySelector(`#graph`), graph_options)
            chart.render();
        };


        function buildGraph() {
            const keys = Object.keys(stats);

            const key = selected || keys[0];
            const data = stats[key];


            graph_options.series = data.series;
            graph_options.xaxis.categories = data.xaxis.categories;
            chart.updateOptions(graph_options);
        };


        main()
    </script>
</body>

</html>