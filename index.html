<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tosu timings graphs</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap');
      .block {
        font-family: 'Montserrat', sans-serif;
        text-align: center;
        margin-bottom: 3em;
      }
    </style>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
      const options = {
        chart: { width: window.innerWidth - 100, height: 300, type: 'area' },
        dataLabels: { enabled: false },
        stroke: { curve: 'smooth' },
        tooltip: {
          x: {
            formatter: function (value) {
              return new Date(value)
                .toISOString()
                .split('T')[1]
                .replace('Z', '')
            }
          }
        },
        xaxis: {
          labels: {
            formatter: function (value, timestamp) {
              return new Date(timestamp).toISOString() // The formatter function overrides format property
            }
          }
        }
      }

      const sleep = ms => {
        return new Promise(resolve => setTimeout(resolve, ms))
      }

      async function main(params) {
        const request = await fetch('/timings.json')
        const text = await request.text()

        const stats = JSON.parse(text)

        for (const key in stats) {
          const data = stats[key]

          const id = key.replace(/\//g, '').trim().toLowerCase()

          const exists = document.getElementById(id) != null
          if (exists) continue

          const div = document.createElement('div')
          div.classList.add('block')
          div.innerHTML = `<h1>${key}</h1><div id="${id}"></div>`

          document.body.append(div)

          await sleep(100)
          const chart = new ApexCharts(document.querySelector(`#${id}`), {
            ...options,
            ...data
          })
          chart.render()
        }
      }

      main()
    </script>
  </body>
</html>
